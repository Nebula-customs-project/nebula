spring:
  application:
    name: gateway-service
  config:
    import: optional:configserver:http://localhost:8761
  main:
    web-application-type: reactive
  cloud:
    config:
      enabled: false
    gateway:
      discovery:
        locator:
          enabled: false
      routes:
        # World-View Service Routes
        - id: world-view-routes
          uri: lb://WORLD-VIEW
          predicates:
            - Path=/api/v1/routes/**

        - id: world-view-journeys
          uri: lb://WORLD-VIEW
          predicates:
            - Path=/api/v1/journeys/**

        # Vehicle Service Routes
        - id: vehicle-service-vehicles
          uri: lb://VEHICLE-SERVICE
          predicates:
            - Path=/api/v1/vehicles/**

      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowedHeaders: "*"
            allowCredentials: false

server:
  port: 8080

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
    register-with-eureka: true
    fetch-registry: true
  instance:
    hostname: localhost
    prefer-ip-address: false
    instance-id: ${spring.application.name}:${server.port}

# JWT Configuration
jwt:
  # For testing WITHOUT user service
  use-hardcoded-key: true

  # We'll generate this in Step 5
  test-public-key: |
    -----BEGIN PUBLIC KEY-----
    MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlG1hhfCW3l1z8o5p6MOw
    KFuFy83dn3VTrleLu2vtWCQo8gmVvInEcR4TIKcnqy4a1vZHVpJhgKHByvIHuPhT
    U9KdRVOMgvjH/kH+5ccH21gm0ychasmu5qVvUQvID4QXuJYATIuX8M5R8zbovaMs
    KSR+LII0Sfr4zvgTuF2O7KmWL3gXRpkXIOYuDXtnOCddgE94CHEMe7LpHWxZ73Bs
    bcHGC8zkk5K2vu+3eJ0FzdyPrvi59yRTzqwW9kFHQ9Kn83hgTpNoqe6MKmegCrvA
    T5zXS6TNmvy/cjuwyxgqFyJdnV+5VtzvoxH0Wl4xNTRdp6UtfrAax/z0pNlEuHpl
    sQIDAQAB
    -----END PUBLIC KEY-----

# Security Configuration
security:
  public-routes:
    # User service endpoints (when ready)
    - /api/users/register
    - /api/users/login
    - /api/users/.well-known/jwks.json

    # Actuator endpoints
    - /actuator/health
    - /actuator/info

    # World-view routes - PUBLIC for testing (remove in production)
    - /api/v1/routes/**
    - /api/v1/journeys/**

    # Vehicle-service routes - PUBLIC for testing (remove in production)
    - /api/v1/vehicles/**

management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
  endpoint:
    health:
      show-details: always
    gateway:
      enabled: true

logging:
  level:
    root: INFO
    pse.nebula.gateway: DEBUG
    org.springframework.cloud.gateway: DEBUG
    org.springframework.cloud.loadbalancer: DEBUG
