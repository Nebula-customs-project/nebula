# =============================================================================
# World View Service Configuration
# Service for driving route simulation to Porsche Zentrum Stuttgart
# =============================================================================
# Database config comes from Config Server via shared-database profile
# Only service-specific overrides (like schema) are defined here
# =============================================================================

spring:

  application:
    name: world-view

  # Import configurations from Config Server
  config:
    import: optional:configserver:http://localhost:8761

  # Activate shared-database profile to get DB config from config server
  profiles:
    active: dev

  # ============ SERVICE-SPECIFIC OVERRIDES ONLY ============
  # Only override JPA schema - all other DB config comes from config server
  jpa:
    open-in-view: false # Disable to prevent lazy loading issues during view rendering
    properties:
      hibernate:
        default_schema: world_view
        # Note: dialect is auto-detected by Hibernate from JDBC URL, no need to specify


# Server Configuration
server:
  port: ${SERVER_PORT:8082}

# Service-specific Eureka instance configuration
# Services will register with Eureka when available
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
    register-with-eureka: true
    fetch-registry: true
    enabled: true
    # Retry configuration
    registry-fetch-interval-seconds: 5
    initial-instance-info-replication-interval-seconds: 5
    instance-info-replication-interval-seconds: 30
    eureka-service-url-poll-interval-seconds: 10
  instance:
    hostname: localhost
    instance-id: ${spring.application.name}:${server.port}
    lease-renewal-interval-in-seconds: 30
    lease-expiration-duration-in-seconds: 90

# Service-specific Logging
logging:
  level:
    root: INFO
    pse.nebula.worldview: INFO
    # Detailed journey progress only in DEBUG mode
    pse.nebula.worldview.application.service.JourneyService: INFO
    # Suppress noisy framework logs
    org.hibernate: WARN
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
    com.zaxxer.hikari: WARN
    org.springframework: WARN
    org.apache: WARN
    # Suppress Eureka shutdown errors (non-critical)
    com.netflix.discovery: WARN
    com.netflix.eureka: WARN
    c.n.d.s.t.d.RetryableEurekaHttpClient: ERROR

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized

# Application Info
info:
  app:
    name: World View Service
    description: Driving route simulation service
    version: 1.0.0

# Journey Configuration (Auto-managed journeys)
journey:
  scheduler:
    update-interval-ms: ${JOURNEY_UPDATE_INTERVAL:2000}
    default-speed-mps: ${JOURNEY_DEFAULT_SPEED:13.89}
    delay-between-journeys-ms: ${JOURNEY_DELAY_BETWEEN:5000}

# Route Configuration (Service-specific)
route:
  dealership:
    name: Dealership
    latitude: 48.8354
    longitude: 9.1520

# MQTT Topic Override (Service-specific)
mqtt:
  client:
    id: world-view-mqtt-client
  topic:
    prefix: nebula/journey